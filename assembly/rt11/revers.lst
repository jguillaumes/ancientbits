REVERS - Invertir cadena de tex	MACRO V05.06  Sunday 31-Dec-95 00:17  Page 1


      1						.TITLE	REVERS - Invertir cadena de text usant stack
      2						.IDENT	/01.00/
      3						.MCALL	.TTYOUT,.TTYIN,.EXIT
      4
      5						; Constants globals
      6		000044 			$JSW 	=: 44
      7		040000 			TTLC$	=: 040000
      8
      9						; Dades estatiques
     10	000000					.PSECT	STATIC,RO,D,LCL,REL,CON
     11
     12	000000	   111 	   156 	   166 	HELLO:	.ASCII	/Inversor de cadenes    /
	000003	   145 	   162 	   163
	000006	   157 	   162 	   040
	000011	   144 	   145 	   040
	000014	   143 	   141 	   144
	000017	   145 	   156 	   145
	000022	   163 	   040 	   040
	000025	   040 	   040
     13		000027 			LHELLO = .-HELLO
     14	000027	   105 	   156 	   164 	PROMPT:	.ASCII	/Entra una linia:	/
	000032	   162 	   141 	   040
	000035	   165 	   156 	   141
	000040	   040 	   154 	   151
	000043	   156 	   151 	   141
	000046	   072 	   011
     15		000021 			LPROMPT = .-PROMPT
     16	000050	   114 	   151 	   156 	INVER:	.ASCII	/Linia invertida:	/
	000053	   151 	   141 	   040
	000056	   151 	   156 	   166
	000061	   145 	   162 	   164
	000064	   151 	   144 	   141
	000067	   072 	   011
     17		000021 			LINVER = .- INVER
     18	000071	   015 			CRLF:	.BYTE	^X0D
     19	000072	   012 				.BYTE	^X0A
     20		000002 			LCRLF = .- CRLF
     21
     22						; Dades modificables
     23	000000					.PSECT	DATA,RW,D,LCL,REL,CON
     24
     25		000256 			LBUFFER = 256
     26	000000				BUFFER:	.BLKB	LBUFFER
     27
     28
     29						; Codi
     30	000000					.PSECT	TEXT,RO,I,LCL,REL,CON
     31
     32	000000				START:	;BPT
     33	000000	052767 	040000 	000044'		BIS	#TTLC$,$JSW	; Desactivar uppercase
     34
     35	000006	012701 	000000'			MOV	#HELLO,R1	; Mostrar salutacio
     36	000012	012702 	000027 			MOV	#LHELLO,R2
     37	000016	004767 	000142 			JSR	PC,LINOUT
     38	000022	004767 	000156 			JSR	PC,LBREAK
     39
     40	000026	012701 	000000'			MOV	#BUFFER,R1	; Netejar buffer. R1 => @BUFFER
REVERS - Invertir cadena de tex	MACRO V05.06  Sunday 31-Dec-95 00:17  Page 1-1


     41	000032	012702 	000256 			MOV	#LBUFFER,R2	; R2 => Grandaria buffer
     42	000036	005000 				CLR	R0		; R0 => zero
     43	000040	110021 			NETEJA:	MOVB	R0,(R1)+	; Netejar byte
     44	000042	077202 				SOB	R2,NETEJA	; Mes espai?
     45
     46	000044	012701 	000027'			MOV	#PROMPT,R1	; Mostrar prompt
     47	000050	012702 	000021 			MOV	#LPROMPT,R2
     48	000054	004767 	000104 			JSR	PC,LINOUT
     49
     50	000060	012701 	000000'			MOV	#BUFFER,R1	; R1 apunta a buffer d'entrada
     51	000064	005002 				CLR	R2		; R2 => comptador de caracters
     52	000066				LLEGIR:	.TTYIN			; LLegir caracter a R0
     53	000072	120027 	000015 			CMPB	R0,#^X0D	; Retorn de carro?
     54	000076	001406 				BEQ	GETLF		; Si, consumir LF
     55	000100	110021 				MOVB	R0,(R1)+	; No, desar caracter
     56	000102	005202 				INC	R2		; Incrementar comptador
     57	000104	020227 	000256 			CMP	R2,#LBUFFER	; Capacitat maxima?
     58	000110	003003 				BGT	PLE		; Si, acabar
     59	000112	000765 				BR	LLEGIR		; No: seg caracter
     60	000114				GETLF:
     61	000114					.TTYIN			; Consumir LF
     62	000120				PLE:				; Buffer ple, acabar aqui
     63	000120	010246 				MOV	R2,-(SP)	; Desar grandaria a stack
     64
     65	000122	012701 	000050'			MOV	#INVER,R1
     66	000126	012702 	000021 			MOV	#LINVER,R2
     67	000132	004767 	000026 			JSR	PC,LINOUT
     68
     69	000136	012602 				MOV	(SP)+,R2
     70
     71	000140	012701 	000000'			MOV	#BUFFER,R1	; Recuperar adreca de buffer
     72	000144	060201 				ADD	R2,R1		; R1 => Final de buffer
     73	000146				OUTR:	.TTYOUT	-(R1)		; Imprimir caracter a final
     74	000154	077204 				SOB	R2,OUTR		; Seguent
     75	000156	004767 	000022 			JSR	PC,LBREAK	; Final de linia
     76
     77	000162					.EXIT
     78
     79					; 	Subrutina per imprimir una linia
     80					;	L'adreca ha d'estar a R1, longitud a R2
     81					;	Destrueix R1 i R2
     82
     83	000164	020227 	000000 		LINOUT:	CMP	R2,#0
     84	000170	003404 				BLE	20$
     85	000172				10$:	.TTYOUT	(R1)+
     86	000200	077204 				SOB	R2,10$
     87	000202	000207 			20$:	RTS	PC
     88
     89
     90	000204	012701 	000071'		LBREAK:	MOV	#CRLF,R1
     91	000210					.TTYOUT	(R1)+
     92	000216					.TTYOUT	(R1)+
     93	000224	000207 				RTS	PC
     94
     95		000000'				.END START
REVERS - Invertir cadena de tex	MACRO V05.06  Sunday 31-Dec-95 00:17  Page 1-2
Symbol table

BUFFER  000000R     003	LBREAK  000204R     004	LINOUT  000164R     004	NETEJA  000040R     004	START   000000R     004
CRLF    000071R     002	LBUFFE= 000256   	LINVER= 000021   	OUTR    000146R     004	TTLC$   040000
GETLF   000114R     004	LCRLF = 000002   	LLEGIR  000066R     004	PLE     000120R     004	$JSW    000044
HELLO   000000R     002	LHELLO= 000027   	LPROMP= 000021   	PROMPT  000027R     002	...V1 = 000003
INVER   000050R     002

. ABS.	000000    000	(RW,I,GBL,ABS,OVR)
      	000000    001	(RW,I,LCL,REL,CON)
STATIC	000073    002	(RO,D,LCL,REL,CON)
DATA  	000256    003	(RW,D,LCL,REL,CON)
TEXT  	000226    004	(RO,I,LCL,REL,CON)
Errors detected:  0

*** Assembler statistics


Work  file  reads: 0
Work  file writes: 0
Size of work file: 10656 Words  ( 42 Pages)
Size of core pool: 22016 Words  ( 86 Pages)
Operating  system: RT-11

Elapsed time: 00:00:00.05
DK:REVERS,DK:REVERS=DK:REVERS
